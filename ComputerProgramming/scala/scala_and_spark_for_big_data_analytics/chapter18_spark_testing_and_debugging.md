# 18장 스파크 테스팅과 디버깅 

18장에서 다루는 내용

* 분산 환경 테스팅
* 스파크 애플리케이션 테스팅
* 스파크 애플리케이션 디버깅

## 분산 환경 테스팅

### 분산 환경

#### 분산 시스템 이슈
분산 환경에서 소프트웨어나 하드웨어로 작업할 때 해결해야 할 다음과 같은 이슈가 있다.

* 확장성 
* 이기종 언어, 플랫폼, 아키텍처
* 자원관리 
* 보안, 개인 정보
* ... (중략) ... (p.924 참고)

모든 이슈를 완전히 해결할 수는 없지만 스칼라를 사용해 분산 시스템과 관련된 일부 사항을 제어할 수 있다.

#### 분산 환경에서의 테스팅 도전 과제

## 스파크 애플리케이션 테스팅

### 스칼라 메소드 테스팅
* ScalaTest
  * 스칼라 사용자에게 가장 친숙한 단위 테스트 프레임워크
  * ScalaTest의 trait를 사용하고, TDD 스타일로 테스트 코드를 작성하면 가장 빠르게 사용할 수 있다.
  * http://www.scalatest.org/user_guide

### 단위 테스트
단위 테스트 장점

* 문제의 조기 발견
* 변경을 용이하게 함
* 통합을 단순화
* 문서화
* 디자인

### 스파크 애플리케이션 테스팅
* 첫 번째 방법: JUnit을 사용한 스파크 애플리케이션 테스팅
* 두 번째 방법: ScalaTest 패키지를 사용한 스파크 애플리케이션 테스팅
* 세 번째 방법: 스파크 테스트 기반을 사용한 스파크 애플리케이션 테스팅

#### 스파크 테스트 기반 장점?
* 상세하지 않은 대신 매우 간결한 코드

## 스파크 애플리케이션 디버깅

### 스파크의 log4j 로깅
org.apache.log4j.Logger 클래스의 한 가지 단점은 직렬화를 지원하지 않는다는 점이다.
직렬화를 진행할 때 매우 큰 객체를 사용하면 셔플이 크게 증가할 수 있다.

#### 직렬화 문제 해결 방법
* 클래스를 직렬화 한다.
* 맵에 전달된 람다 함수 안에만 인스턴스를 선언한다.
* 직렬화되지 않은 객체를 static으로 생성하고 장비마다 해당 객체를 생성한다.
* map 대신 forEachPartition이나 mapPartitons를 호출하고 직렬화되지 않은 객체를 생성한다.

### 스파크 애플리케이션 디버깅 
스파크 애플리케이션을 로컬 모드나 독립형 모드로 디버깅할 때 드라이버 프로그램을 디버깅하는 것과 익스큐터 중 하나를 디버깅하는 것은 다르다.

## 요약
분산 환경에서 테스트하는 방법을 살펴봤다.

<!>논의: 우리가 수행하려는 분석 타입은 무엇일까요?

